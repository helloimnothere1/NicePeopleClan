<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>i eat pickes -1x1x1x1</title>
  <style>
    body {
      margin: 0;
      font-family: sans-serif;
      background: black;
      color: white;
      border: 10px solid red;
      animation: bodyBorderRainbow 5s linear infinite;
    }
    @keyframes bodyBorderRainbow {
      0%   { border-color: hsl(0, 100%, 50%); }
      16.6%  { border-color: hsl(60, 100%, 50%); }
      33.3%  { border-color: hsl(120, 100%, 50%); }
      50%  { border-color: hsl(180, 100%, 50%); }
      66.6%  { border-color: hsl(240, 100%, 50%); }
      83.3%  { border-color: hsl(300, 100%, 50%); }
      100% { border-color: hsl(360, 100%, 50%); }
    }
    section {
      min-height: 100vh;
      padding: 20px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
    }
    h1 { font-size: 3rem; margin: 10px 0; }
    button {
      background: red;
      border: 5px solid;
      border-radius: 15px;
      color: white;
      font-size: 18px;
      padding: 10px 20px;
      cursor: pointer;
      margin: 10px 0;
      animation: borderRainbow 3s linear infinite;
      min-width: 150px;
    }
    #skillTreeButton {
      background: blue;
    }
    @keyframes borderRainbow {
      0%   { border-color: hsl(0, 100%, 50%); }
      16.6%  { border-color: hsl(60, 100%, 50%); }
      33.3%  { border-color: hsl(120, 100%, 50%); }
      50%  { border-color: hsl(180, 100%, 50%); }
      66.6%  { border-color: hsl(240, 100%, 50%); }
      83.3%  { border-color: hsl(300, 100%, 50%); }
      100% { border-color: hsl(360, 100%, 50%); }
    }
    #startButton {
      background: red;
      color: white;
      font-size: 2.5rem;
      padding: 20px 40px;
      border: 5px solid white;
      border-radius: 15px;
      cursor: pointer;
      animation: borderRainbow 3s linear infinite;
    }
    .divider {
      width: 100%;
      height: 10px;
      animation: bodyBorderRainbow 5s linear infinite;
    }
    .shop, .upgradeShop {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      margin: 10px 0;
      width: 80%;
    }
    .shop button, .upgradeShop button {
      flex: 1 1 150px;
      margin: 5px;
    }
    #dps {
      font-size: 2rem;
      display: none;
      margin-top: 10px;
      animation: rainbowText 5s linear infinite;
    }
    @keyframes rainbowText {
      0% { color: hsl(0, 100%, 50%); }
      16% { color: hsl(60, 100%, 50%); }
      33% { color: hsl(120, 100%, 50%); }
      50% { color: hsl(180, 100%, 50%); }
      66% { color: hsl(240, 100%, 50%); }
      83% { color: hsl(300, 100%, 50%); }
      100% { color: hsl(360, 100%, 50%); }
    }
    .plus1 {
      position: absolute;
      font-size: 20px;
      animation: floatUp 1s ease-out forwards;
      color: yellow;
      pointer-events: none;
    }
    @keyframes floatUp {
      from { opacity: 1; transform: translateY(0); }
      to { opacity: 0; transform: translateY(-50px); }
    }
    .hidden { display: none; }
    #rebirthSection {
      margin-top: 20px;
      text-align: center;
    }
    #rebirthButton {
      background: purple;
      color: white;
      font-size: 18px;
      border: 5px solid white;
      border-radius: 10px;
      padding: 10px 20px;
    }
    #skillTreeContainer {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 20px;
      padding: 20px;
    }
    .skill-node {
      border: 2px solid cyan;
      border-radius: 10px;
      padding: 10px;
      width: 200px;
      background: rgba(0, 255, 255, 0.1);
      text-align: center;
    }
    /* New Styles for Sugar Lump & mini-games */
    #sugarLumps {
      margin: 10px 0;
      font-size: 1.5rem;
      border: 2px solid #ffcc00;
      border-radius: 10px;
      padding: 10px 20px;
      background: #222200aa;
      cursor: pointer;
      user-select: none;
      animation: pulseGlow 3s infinite;
    }
    @keyframes pulseGlow {
      0%, 100% { box-shadow: 0 0 10px 3px #ffcc00; }
      50% { box-shadow: 0 0 20px 6px #ffff55; }
    }
    #farmUI, #aiCoreUI {
      border: 2px solid cyan;
      border-radius: 10px;
      padding: 10px;
      margin-top: 15px;
      background: #002222aa;
      width: 90%;
      max-width: 600px;
      color: white;
      font-size: 1rem;
    }
    #farmUI h2, #aiCoreUI h2 {
      margin-top: 0;
    }
    #farmSeeds {
      display: flex;
      justify-content: space-around;
      margin: 10px 0;
    }
    #farmSeeds button {
      flex: 1 1 100px;
      margin: 5px;
      background: green;
      border-color: darkgreen;
    }
    #farmStatus {
      margin-top: 10px;
      min-height: 30px;
    }
    #stockTable {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }
    #stockTable th, #stockTable td {
      border: 1px solid cyan;
      padding: 6px 10px;
      text-align: center;
    }
    #stockTable th {
      background: #005555cc;
    }
    #stockMarketActions button {
      margin: 5px;
      min-width: 60px;
    }
    #stockMarketActions input {
      width: 50px;
      text-align: center;
    }
  </style>
</head>
<body>
  <section id="page1">
    <h1>Welcome!</h1>
    <button id="startButton">Start Game</button>
  </section>

  <div class="divider hidden" id="divider2"></div>

  <section id="page2" class="hidden">
    <h1 id="counter">0</h1>
    <button id="clickButton">Click Me</button>
    <div id="dps"></div>

    <!-- Sugar Lumps -->
    <div id="sugarLumps" title="Click to harvest sugar lumps">Sugar Lumps: <span id="sugarLumpCount">0</span></div>

    <div id="rebirthSection" class="hidden">
      <h2>Rebirths: <span id="rebirthCount">0</span></h2>
      <button id="rebirthButton">Rebirth (Cost: 10000)</button>
    </div>

    <button id="skillTreeButton" class="hidden">Open Skill Tree</button>
  </section>

  <div class="divider hidden" id="divider3"></div>

  <section id="page3" class="hidden">
    <h1>Buildings</h1>
    <div class="shop" id="shop"></div>

    <!-- Farm Mini-game UI -->
    <div id="farmUI">
      <h2>Farm Mini-game</h2>
      <div>Seeds Owned: <span id="seedsCount">0</span></div>
      <div id="farmSeeds">
        <button data-seed="wheat">Plant Wheat (+1.01x CPS/min)</button>
        <button data-seed="corn">Plant Corn (+1.015x CPS/min)</button>
        <button data-seed="carrot">Plant Carrot (+1.02x CPS/min)</button>
      </div>
      <div>Planted Seeds: <span id="plantedSeeds">0</span></div>
      <div id="farmStatus"></div>
    </div>
  </section>

  <div class="divider hidden" id="divider4"></div>

  <section id="page4" class="hidden">
    <h1>Upgrades</h1>
    <div class="upgradeShop" id="upgrades"></div>

    <!-- AI Core Mini-game UI -->
    <div id="aiCoreUI">
      <h2>AI Core Stock Market</h2>
      <table id="stockTable">
        <thead>
          <tr>
            <th>Stock</th>
            <th>Price</th>
            <th>Your Shares</th>
            <th>Buy</th>
            <th>Sell</th>
          </tr>
        </thead>
        <tbody>
          <tr data-stock="Trains">
            <td>Trains</td>
            <td class="price">0</td>
            <td class="shares">0</td>
            <td>
              <input type="number" min="1" value="1" class="buyAmount" />
              <button class="buyBtn">Buy</button>
            </td>
            <td>
              <input type="number" min="1" value="1" class="sellAmount" />
              <button class="sellBtn">Sell</button>
            </td>
          </tr>
          <tr data-stock="Milk">
            <td>Milk</td>
            <td class="price">0</td>
            <td class="shares">0</td>
            <td>
              <input type="number" min="1" value="1" class="buyAmount" />
              <button class="buyBtn">Buy</button>
            </td>
            <td>
              <input type="number" min="1" value="1" class="sellAmount" />
              <button class="sellBtn">Sell</button>
            </td>
          </tr>
          <tr data-stock="Sugar">
            <td>Sugar</td>
            <td class="price">0</td>
            <td class="shares">0</td>
            <td>
              <input type="number" min="1" value="1" class="buyAmount" />
              <button class="buyBtn">Buy</button>
            </td>
            <td>
              <input type="number" min="1" value="1" class="sellAmount" />
              <button class="sellBtn">Sell</button>
            </td>
          </tr>
          <tr data-stock="Butter">
            <td>Butter</td>
            <td class="price">0</td>
            <td class="shares">0</td>
            <td>
              <input type="number" min="1" value="1" class="buyAmount" />
              <button class="buyBtn">Buy</button>
            </td>
            <td>
              <input type="number" min="1" value="1" class="sellAmount" />
              <button class="sellBtn">Sell</button>
            </td>
          </tr>
        </tbody>
      </table>
      <div style="margin-top:10px;">Your Money: <span id="moneyDisplay">0</span></div>
    </div>
  </section>

  <div class="divider hidden" id="divider5"></div>

  <section id="page5" class="hidden">
    <h1>Skill Tree</h1>
    <div id="skillTreeContainer">
      <div class="skill-node">
        <h3>Power Click</h3>
        <p>+50% Click Power</p>
        <button disabled>Requires SP</button>
      </div>
      <div class="skill-node">
        <h3>Efficiency Boost</h3>
        <p>+10% Global DPS</p>
        <button disabled>Requires SP</button>
      </div>
    </div>
  </section>

  <script>
    // Base game variables
    let count = 0;
    let clickPower = 1;
    let globalDPS = 0;

    let rebirths = 0;
    let rebirthCost = 10000;
    let rebirthMultiplier = 1;

    // Sugar lumps variables
    let sugarLumps = 0;
    let sugarLumpGainRate = 1 / (60 * 5); // 1 lump every 5 minutes

    // Seeds and farm mini-game
    let seedsOwned = 0;
    let plantedSeeds = 0;
    let plantedSeedDetails = []; // Array of {type, plantedAt}
    const seedTypes = {
      wheat: { multiplierPerMinute: 1.01 },
      corn: { multiplierPerMinute: 1.015 },
      carrot: { multiplierPerMinute: 1.02 }
    };

    // AI Core Stock Market
    const stocks = {
      Trains: { price: 50, shares: 0 },
      Milk: { price: 50, shares: 0 },
      Sugar: { price: 50, shares: 0 },
      Butter: { price: 50, shares: 0 }
    };
    const STOCK_CAP = 200;
    let money = 100000; // Player's money for stocks and purchases

    // Buildings, upgrades (unchanged from your code, just simplified here)
    const buildings = [
      { name: "Autoclicker", baseCost: 100, cps: 1, owned: 0 },
      { name: "Grandpa", baseCost: 1000, cps: 5, owned: 0 },
      { name: "Farm", baseCost: 5000, cps: 25, owned: 0 },
      { name: "Factory", baseCost: 50000, cps: 150, owned: 0 },
      { name: "Wizard Tower", baseCost: 500000, cps: 1000, owned: 0 },
      { name: "Time Rift", baseCost: 10000000, cps: 10000, owned: 0 },
      { name: "AI Core", baseCost: 100000000, cps: 100000, owned: 0 },
      { name: "Universe Core", baseCost: 10000000000, cps: 1000000, owned: 0 }
    ];

    const upgrades = []; // omitted for brevity, assume as your original code

    // DOM references
    const counter = document.getElementById("counter");
    const clickButton = document.getElementById("clickButton");
    const dpsDisplay = document.getElementById("dps");
    const shop = document.getElementById("shop");
    const upgradesShop = document.getElementById("upgrades");
    const rebirthSection = document.getElementById("rebirthSection");
    const rebirthButton = document.getElementById("rebirthButton");
    const rebirthCountDisplay = document.getElementById("rebirthCount");
    const skillTreeButton = document.getElementById("skillTreeButton");
    const sugarLumpCount = document.getElementById("sugarLumpCount");

    // Farm UI elements
    const seedsCountDisplay = document.getElementById("seedsCount");
    const plantedSeedsDisplay = document.getElementById("plantedSeeds");
    const farmStatus = document.getElementById("farmStatus");
    const farmSeedButtons = document.querySelectorAll("#farmSeeds button");

    // AI Core UI elements
    const stockTableBody = document.querySelector("#stockTable tbody");
    const moneyDisplay = document.getElementById("moneyDisplay");

    // Initialize shop buttons for buildings
    buildings.forEach((b, i) => {
      const btn = document.createElement("button");
      btn.id = `buy-${i}`;
      btn.textContent = `Buy ${b.name} (Cost: ${b.baseCost}, Owned: 0)`;
      btn.addEventListener("click", () => buyBuilding(i));
      shop.appendChild(btn);
    });

    // Sugar Lumps: Increment over time
    function gainSugarLumps(deltaSeconds) {
      sugarLumps += sugarLumpGainRate * deltaSeconds;
      sugarLumpCount.textContent = Math.floor(sugarLumps);
    }

    // When player clicks sugar lumps UI
    document.getElementById("sugarLumps").addEventListener("click", () => {
      const lumpsToHarvest = Math.floor(sugarLumps);
      if (lumpsToHarvest > 0) {
        sugarLumps -= lumpsToHarvest;
        // For now, just add to money as a bonus, can be changed later
        money += lumpsToHarvest * 1000;
        moneyDisplay.textContent = money.toLocaleString();
        alert(`You harvested ${lumpsToHarvest} sugar lumps! +$${lumpsToHarvest * 1000} money`);
        sugarLumpCount.textContent = Math.floor(sugarLumps);
      } else {
        alert("No sugar lumps to harvest yet!");
      }
    });

    // Farm mini-game: plant seeds
    farmSeedButtons.forEach(btn => {
      btn.addEventListener("click", () => {
        const seed = btn.getAttribute("data-seed");
        if (seedsOwned >= 1) {
          seedsOwned--;
          plantedSeeds++;
          plantedSeedDetails.push({ type: seed, plantedAt: Date.now() });
          updateFarmUI();
        } else {
          alert("You don't have any seeds to plant!");
        }
      });
    });

    // Farm bonus calculation every minute
    setInterval(() => {
      if (plantedSeedDetails.length > 0) {
        let multiplier = 1;
        plantedSeedDetails.forEach(seedData => {
          const seedType = seedTypes[seedData.type];
          if (seedType) {
            multiplier *= seedType.multiplierPerMinute;
          }
        });
        // Apply multiplier to buildings cps
        buildings.forEach(b => {
          b.cps *= multiplier;
        });
        farmStatus.textContent = `Farm boost applied! CPS multiplied by ${multiplier.toFixed(3)}`;
        updateDPS();
      }
    }, 60000); // every 60 seconds

    function updateFarmUI() {
      seedsCountDisplay.textContent = seedsOwned;
      plantedSeedsDisplay.textContent = plantedSeeds;
      farmStatus.textContent = `You have planted ${plantedSeeds} seeds. CPS boosted every minute!`;
    }

    // AI Core Stock Market: Random price fluctuation + buy/sell

    function randomStockFluctuation() {
      Object.keys(stocks).forEach(stock => {
        let change = (Math.random() - 0.5) * 10; // Random between -5 and +5 approx
        let newPrice = stocks[stock].price + change;
        if (newPrice < 1) newPrice = 1;
        if (newPrice > STOCK_CAP) newPrice = STOCK_CAP;
        stocks[stock].price = Math.round(newPrice * 100) / 100; // round 2 decimals
      });
      updateStockMarketUI();
    }

    // Update stock market UI prices and shares
    function updateStockMarketUI() {
      moneyDisplay.textContent = money.toLocaleString();
      stockTableBody.querySelectorAll("tr").forEach(row => {
        const stock = row.getAttribute("data-stock");
        row.querySelector(".price").textContent = stocks[stock].price.toFixed(2);
        row.querySelector(".shares").textContent = stocks[stock].shares;
      });
    }

    // Buy/Sell buttons in stock market
    stockTableBody.querySelectorAll("tr").forEach(row => {
      const stock = row.getAttribute("data-stock");
      const buyBtn = row.querySelector(".buyBtn");
      const sellBtn = row.querySelector(".sellBtn");
      const buyInput = row.querySelector(".buyAmount");
      const sellInput = row.querySelector(".sellAmount");

      buyBtn.addEventListener("click", () => {
        let amount = parseInt(buyInput.value) || 0;
        if (amount < 1) return alert("Buy amount must be at least 1");
        const price = stocks[stock].price;
        const cost = price * amount;
        if (cost > money) {
          alert("Not enough money!");
          return;
        }
        if (stocks[stock].shares + amount > STOCK_CAP) {
          alert(`Cannot hold more than ${STOCK_CAP} shares of ${stock}`);
          return;
        }
        money -= cost;
        stocks[stock].shares += amount;
        updateStockMarketUI();
      });

      sellBtn.addEventListener("click", () => {
        let amount = parseInt(sellInput.value) || 0;
        if (amount < 1) return alert("Sell amount must be at least 1");
        if (amount > stocks[stock].shares) {
          alert("You don't have that many shares!");
          return;
        }
        const price = stocks[stock].price;
        const revenue = price * amount;
        stocks[stock].shares -= amount;
        money += revenue;
        updateStockMarketUI();
      });
    });

    // Main Game Functions:

    function updateCounter() {
      counter.textContent = Math.floor(count);
    }

    function updateDPS() {
      // Base DPS from buildings
      globalDPS = buildings.reduce((sum, b) => sum + b.owned * b.cps, 0) * rebirthMultiplier;
      if (globalDPS > 0) {
        dpsDisplay.style.display = "block";
        dpsDisplay.textContent = `+${Math.floor(globalDPS)} /s`;
      } else {
        dpsDisplay.style.display = "none";
      }
    }

    function updateRebirthUI() {
      rebirthCountDisplay.textContent = rebirths;
      rebirthButton.textContent = `Rebirth (Cost: ${Math.floor(rebirthCost)})`;
      if (count >= rebirthCost) {
        rebirthSection.classList.remove("hidden");
      } else {
        rebirthSection.classList.add("hidden");
      }

      if (rebirths >= 1) {
        skillTreeButton.classList.remove("hidden");
      }
    }

    function buyBuilding(index) {
      const building = buildings[index];
      const cost = building.baseCost * Math.pow(1.15, building.owned);
      if (count >= cost) {
        count -= cost;
        building.owned++;
        updateCounter();
        updateBuildingButton(index);
        updateDPS();
      } else {
        alert("Not enough pickes!");
      }
    }

    function updateBuildingButton(index) {
      const building = buildings[index];
      const btn = document.getElementById(`buy-${index}`);
      const cost = building.baseCost * Math.pow(1.15, building.owned);
      btn.textContent = `Buy ${building.name} (Cost: ${Math.floor(cost)}, Owned: ${building.owned})`;
    }

    // Clicking increments count by clickPower
    clickButton.addEventListener("click", () => {
      count += clickPower;
      updateCounter();

      // Show +1 animation
      const plus1 = document.createElement("div");
      plus1.textContent = `+${clickPower}`;
      plus1.classList.add("plus1");
      document.body.appendChild(plus1);
      plus1.style.left = (clickButton.getBoundingClientRect().left + Math.random() * clickButton.clientWidth) + "px";
      plus1.style.top = (clickButton.getBoundingClientRect().top - 10) + "px";
      setTimeout(() => plus1.remove(), 1000);
    });

    // Rebirth button
    rebirthButton.addEventListener("click", () => {
      if (count >= rebirthCost) {
        rebirths++;
        count = 0;
        rebirthCost *= 2;
        rebirthMultiplier += 0.2; // each rebirth multiplies CPS by 1.2x
        buildings.forEach(b => b.owned = 0); // Reset buildings on rebirth
        plantedSeeds = 0;
        plantedSeedDetails = [];
        seedsOwned = 0;
        updateFarmUI();
        updateBuildingButtons();
        updateCounter();
        updateRebirthUI();
        updateDPS();
      } else {
        alert("Not enough pickes to rebirth!");
      }
    });

    function updateBuildingButtons() {
      buildings.forEach((_, i) => updateBuildingButton(i));
    }

    // Start button shows game UI and starts game loops
    const startButton = document.getElementById("startButton");
    const page1 = document.getElementById("page1");
    const page2 = document.getElementById("page2");
    const page3 = document.getElementById("page3");
    const page4 = document.getElementById("page4");
    const divider2 = document.getElementById("divider2");
    const divider3 = document.getElementById("divider3");
    const divider4 = document.getElementById("divider4");

    startButton.addEventListener("click", () => {
      page1.classList.add("hidden");
      divider2.classList.remove("hidden");
      page2.classList.remove("hidden");
      divider3.classList.remove("hidden");
      page3.classList.remove("hidden");
      divider4.classList.remove("hidden");
      page4.classList.remove("hidden");

      // Initial UI update
      updateCounter();
      updateDPS();
      updateRebirthUI();
      updateFarmUI();
      updateStockMarketUI();

      // Give player some seeds initially
      seedsOwned = 10;
      updateFarmUI();

      // Start the main game loop
      lastUpdateTime = Date.now();
      gameLoop();
      stockFluctuationLoop();
    });

    // Game loop variables
    let lastUpdateTime = Date.now();

    function gameLoop() {
      const now = Date.now();
      const delta = (now - lastUpdateTime) / 1000;
      lastUpdateTime = now;

      // Add global DPS * delta seconds to count
      count += globalDPS * delta;
      updateCounter();

      // Gain sugar lumps over time
      gainSugarLumps(delta);

      requestAnimationFrame(gameLoop);
    }

    // Stock price fluctuation loop (every 5 seconds)
    function stockFluctuationLoop() {
      randomStockFluctuation();
      setTimeout(stockFluctuationLoop, 5000);
    }

  </script>
</body>
</html>
